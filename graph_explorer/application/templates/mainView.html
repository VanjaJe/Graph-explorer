
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

                <style>
                .node {
                cursor: pointer;
                color: #5b5b5b;
                text-align: center;
                }

                .link {
                fill: none;
                stroke: #333333;
                stroke-width: 1.5px;
                }
                </style>

                <script type="text/javascript">

                    $(document).ready(function(){
                        init();
                    });

                     var aspectRatioHeight = null;
                     var aspectRatioWidth = null;
                     var home = null;
                     var minimapDimensions = null;
                     var minimapViewer = null;
                     var minimapViewerDimensions = null;
                     var birdViewWidth = null;
                     var birdViewHeight = null;
                     var viewportDimensions = null;
                     var zoom = null;

                     viewportDimensions = {
                       height: 500,
                       width: 600
                     }

                     aspectRatioHeight = 0.25;
                     aspectRatioWidth = 0.25;

                     minimapDimensions = {
                       height: viewportDimensions.height * aspectRatioHeight,
                       width: viewportDimensions.width * aspectRatioWidth
                     };

                     minimapViewerDimensions = {
                       height: minimapDimensions.height,
                       width: minimapDimensions.width
                     }

                     home = d3.select("#mainView").node();

                    var current = null;

                    var nodesGraph = JSON.parse("{\u0022football\u0022: {\u0022id\u0022: \u0022ID_football\u0022, \u0022attributes\u0022: [\u0022id: football\u0022, \u0022value: football\u0022]}, \u0022tennis\u0022: {\u0022id\u0022: \u0022ID_tennis\u0022, \u0022attributes\u0022: [\u0022id: tennis\u0022, \u0022value: tennis\u0022]}, \u00222\u0022: {\u0022id\u0022: \u0022ID_2\u0022, \u0022attributes\u0022: [\u0022id: 2\u0022, \u0022name: Dmitry Petelin\u0022]}, \u00226\u0022: {\u0022id\u0022: \u0022ID_6\u0022, \u0022attributes\u0022: [\u0022id: 6\u0022, \u0022name: Koichi Wakata\u0022]}, \u002210\u0022: {\u0022id\u0022: \u0022ID_10\u0022, \u0022attributes\u0022: [\u0022id: 10\u0022, \u0022name: Frank Rubio\u0022]}, \u00221\u0022: {\u0022id\u0022: \u0022ID_1\u0022, \u0022attributes\u0022: [\u0022id: 1\u0022, \u0022name: Sergey Prokopyev\u0022]}, \u0022bowling\u0022: {\u0022id\u0022: \u0022ID_bowling\u0022, \u0022attributes\u0022: [\u0022id: bowling\u0022, \u0022value: bowling\u0022]}, \u0022painting\u0022: {\u0022id\u0022: \u0022ID_painting\u0022, \u0022attributes\u0022: [\u0022id: painting\u0022, \u0022value: painting\u0022]}, \u0022singing\u0022: {\u0022id\u0022: \u0022ID_singing\u0022, \u0022attributes\u0022: [\u0022id: singing\u0022, \u0022value: singing\u0022]}, \u00224\u0022: {\u0022id\u0022: \u0022ID_4\u0022, \u0022attributes\u0022: [\u0022id: 4\u0022, \u0022name: Nicole Mann\u0022]}, \u0022cooking\u0022: {\u0022id\u0022: \u0022ID_cooking\u0022, \u0022attributes\u0022: [\u0022id: cooking\u0022, \u0022value: cooking\u0022]}, \u0022fishing\u0022: {\u0022id\u0022: \u0022ID_fishing\u0022, \u0022attributes\u0022: [\u0022id: fishing\u0022, \u0022value: fishing\u0022]}, \u0022hunting\u0022: {\u0022id\u0022: \u0022ID_hunting\u0022, \u0022attributes\u0022: [\u0022id: hunting\u0022, \u0022value: hunting\u0022]}, \u00225\u0022: {\u0022id\u0022: \u0022ID_5\u0022, \u0022attributes\u0022: [\u0022id: 5\u0022, \u0022name: Josh Cassada\u0022]}, \u0022dancing\u0022: {\u0022id\u0022: \u0022ID_dancing\u0022, \u0022attributes\u0022: [\u0022id: dancing\u0022, \u0022value: dancing\u0022]}, \u00228\u0022: {\u0022id\u0022: \u0022ID_8\u0022, \u0022attributes\u0022: [\u0022id: 8\u0022, \u0022name: Fei Junlong\u0022]}, \u00227\u0022: {\u0022id\u0022: \u0022ID_7\u0022, \u0022attributes\u0022: [\u0022id: 7\u0022, \u0022name: Anna Kikina\u0022]}, \u0022teaching\u0022: {\u0022id\u0022: \u0022ID_teaching\u0022, \u0022attributes\u0022: [\u0022id: teaching\u0022, \u0022value: teaching\u0022]}, \u0022golfing\u0022: {\u0022id\u0022: \u0022ID_golfing\u0022, \u0022attributes\u0022: [\u0022id: golfing\u0022, \u0022value: golfing\u0022]}, \u00229\u0022: {\u0022id\u0022: \u0022ID_9\u0022, \u0022attributes\u0022: [\u0022id: 9\u0022, \u0022name: Deng Qingming\u0022]}}");
                    var links= JSON.parse("[{\u0022source\u0022: 1, \u0022target\u0022: \u0022football\u0022}, {\u0022source\u0022: 9, \u0022target\u0022: \u0022dancing\u0022}, {\u0022source\u0022: 1, \u0022target\u0022: \u0022tennis\u0022}, {\u0022source\u0022: 10, \u0022target\u0022: \u0022teaching\u0022}, {\u0022source\u0022: 2, \u0022target\u0022: \u0022bowling\u0022}, {\u0022source\u0022: 8, \u0022target\u0022: \u0022teaching\u0022}, {\u0022source\u0022: 6, \u0022target\u0022: 2}, {\u0022source\u0022: 4, \u0022target\u0022: \u0022cooking\u0022}, {\u0022source\u0022: 6, \u0022target\u0022: \u0022fishing\u0022}, {\u0022source\u0022: 10, \u0022target\u0022: \u0022dancing\u0022}, {\u0022source\u0022: 5, \u0022target\u0022: 6}, {\u0022source\u0022: 10, \u0022target\u0022: 2}, {\u0022source\u0022: 1, \u0022target\u0022: 2}, {\u0022source\u0022: 2, \u0022target\u0022: 1}, {\u0022source\u0022: 6, \u0022target\u0022: 4}, {\u0022source\u0022: 6, \u0022target\u0022: 10}, {\u0022source\u0022: 10, \u0022target\u0022: \u0022painting\u0022}, {\u0022source\u0022: 2, \u0022target\u0022: \u0022football\u0022}, {\u0022source\u0022: 4, \u0022target\u0022: 10}, {\u0022source\u0022: 8, \u0022target\u0022: 7}, {\u0022source\u0022: 10, \u0022target\u0022: 4}, {\u0022source\u0022: 8, \u0022target\u0022: \u0022golfing\u0022}, {\u0022source\u0022: 7, \u0022target\u0022: \u0022dancing\u0022}, {\u0022source\u0022: 5, \u0022target\u0022: \u0022fishing\u0022}, {\u0022source\u0022: 4, \u0022target\u0022: \u0022singing\u0022}, {\u0022source\u0022: 2, \u0022target\u0022: 6}, {\u0022source\u0022: 1, \u0022target\u0022: 10}, {\u0022source\u0022: 5, \u0022target\u0022: \u0022hunting\u0022}, {\u0022source\u0022: 10, \u0022target\u0022: \u0022singing\u0022}, {\u0022source\u0022: 7, \u0022target\u0022: 8}]");

                    links.forEach(function(link) {
                        link.source = nodesGraph[link.source];
                        link.target = nodesGraph[link.target];
                    });

                    var svg = d3.select('#mainView').call(d3.behavior.zoom().on("zoom", function () {
                                            svg.attr("transform", " translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
                                    })).append('g');

                    var force = d3.layout.force()
                        .charge(-550)
                        .linkDistance(600)
                        .size([1100, 500])
                        .nodes(d3.values(nodesGraph))
                        .links(links)
                        .on("tick", tick)
                        .gravity(0.3)
                        .start();

                    var link = svg.selectAll('.link')
                        .data(links)
                        .enter().append('line')
                        .attr('class', 'link');

                    var node = svg.selectAll('.node')
                        .data(force.nodes())
                        .enter().append('g')
                        .attr('class', 'node')
                        .attr('id', function(d){return d.id;})
                        .on('click', clicked);
                    d3.selectAll('.node').each(function(d){nodeView(d, '#595959');});

                    function nodeView(d, color){
                        var width=30;
                        var textSize=12;

                        d3.select("g#"+d.id).append('circle').
                        attr('cx',0).attr('cy', 0).attr('r', width).attr('fill', color);

                        d3.select("g#"+d.id).append('text').attr('x', 0).attr('y', 4)
                        .attr('text-anchor','middle')
                        .attr('font-size',textSize).attr('font-family','poppins')
                        .attr('fill','white').text(d.id);
                    }

                    while (force.alpha() > force.alphaMin()) { force.tick(); ticked(); }

                    function tick(e) {

                        node.attr("transform", function(d) {return "translate(" + d.x + "," + d.y + ")";})
                            .call(force.drag);

                        link.attr('x1', function(d) { return d.source.x; })
                            .attr('y1', function(d) { return d.source.y; })
                            .attr('x2', function(d) { return d.target.x; })
                            .attr('y2', function(d) { return d.target.y; });

                    }

                    function ticked() {
                        // console.log("Ticked");
                        node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
                    }

                    function clicked(el){
                        console.log("USAO U CLICKED")
                        var message = "";
                        message += "ID:" + el.id + ", ";
                        if(current != null) {
                            d3.selectAll('.node').each(function(d){nodeView(d, '#595959');});
                            nodeView(nodesGraph[current.id.replace("ID_", "")], '#1a324c')
                        }
                        var node = nodesGraph[el.id.replace("ID_", "")];
                        current = node;
                        nodeView(current, '#1a324c')
                        for(var i=0;i<node.attributes.length;i++) {
                            message += node.attributes[i] + ", ";
                        }
                        console.log("PORUKA: " + message)
                        alert(message)
                        const wait = (n) => new Promise((resolve) => setTimeout(resolve, n));
                        const changeBackColor = async () => {
                          await wait(5000);
                          nodeView(node, '#595959')
                          node.attr('transform', function(d) {return 'translate(' + d.x + ',' + d.y + ')';}).call(force.drag);
                        };
                        // call the async function
                        changeBackColor();
                        node.attr('transform', function(d) {return 'translate(' + d.x + ',' + d.y + ')';}).call(force.drag);
                    }

                    init();

                    function init() {

                        // let graphWidth = d3.select("#mainView").select("g").node().getBBox().width;
                        // let graphHeight = d3.select("#mainView").select("g").node().getBBox().height;
                        //
                        // let mainWidth = document.getElementById("top").offsetWidth;
                        // let mainHeight = document.getElementById("top").offsetHeight;
                        //
                        // let birdWidth = $("#birdView")[0].clientWidth;
                        // let birdHeight = $("#birdView")[0].clientHeight;
                        //
                        // let birdViewWidth = document.getElementById("divBird").offsetWidth
                        // let birdViewHeight = document.getElementById("divBird").offsetHeight
                        //
                        // minimapViewerDimensions.height = birdViewHeight * graphHeight/mainHeight;
                        // minimapViewerDimensions.width = birdViewWidth * graphWidth/mainWidth;
                        //
                        // console.log(minimapViewerDimensions.height)
                        //
                        // minimapViewer = d3.select("#birdView")
                        //    .append("rect")
                        //    .attr("fill", "transparent")
                        //    .attr("height", 50 + "px")
                        //    .attr("width", 50 + "px")
                        //    .attr("id", "minimapViewer")
                        //    .attr("stroke", '#1a324c')
                        //    .attr("stroke-width", 2);

                        let main = d3.select("#mainView").node();

                        let observer = new MutationObserver(observer_callback);

                        observer.observe(main, {
                            subtree: true,
                            attributes: true,
                            childList: true,
                            characterData: true
                        });
                    }

                    function observer_callback() {
                        let main = d3.select("#mainView").html();
                        d3.select("#birdView").html(main);

                        let graphWidth = d3.select("#mainView").select("g").node().getBBox().width;
                        let graphHeight = d3.select("#mainView").select("g").node().getBBox().height;

                        let mainWidth = document.getElementById("top").offsetWidth;
                        let mainHeight = document.getElementById("top").offsetHeight;


                        birdViewWidth = document.getElementById("divBird").offsetWidth
                        birdViewHeight = document.getElementById("divBird").offsetHeight


                        let birdWidth = $("#birdView")[0].clientWidth;
                        let birdHeight = $("#birdView")[0].clientHeight;


                        let scaleWidth = birdWidth / graphWidth;
                        let scaleHeight = birdHeight / graphHeight;

                        let scale = 0;
                        if(scaleWidth < scaleHeight){
                            scale = scaleWidth;
                        }else{
                            scale = scaleHeight;
                        }

                        let x = d3.select("#birdView").select("g").node().getBBox().x;
                        let y = d3.select("#birdView").select("g").node().getBBox().y;
                        d3.select("#birdView").select('g').attr("transform", "translate ("+[-x*scale, -y*scale]+") scale("+ scale +")");


                        let graphPosition = null;

                        let element = document.getElementsByTagName('g')[0];

                        if (element) {
                            // Dobijanje dimenzija i pozicije elementa u odnosu na prozor pregledača
                            let rect = element.getBoundingClientRect();

                            // Relativna pozicija u odnosu na prozor pregledača
                            graphPosition = {
                                top: rect.top,
                                left: rect.left,
                                width: rect.width,
                                height: rect.height
                            };

                            console.log(graphPosition.top)

                        minimapViewerDimensions.top = graphPosition.top * graphHeight/mainHeight;
                        minimapViewerDimensions.left = graphPosition.left * graphWidth/mainWidth;
                        }

                        minimapViewerDimensions.height = birdViewHeight * graphHeight/mainHeight;
                        minimapViewerDimensions.width = birdViewWidth * graphWidth/mainWidth;


                         //Add a white viewbox onto the top of the minimap
                         minimapViewer = d3.select("#birdView")
                           .append("rect")
                           .attr("fill", "transparent")
                           .attr("height", minimapViewerDimensions.height + "px")
                           .attr("width", minimapViewerDimensions.width + "px")
                           .attr("x", minimapViewerDimensions.left+"px")
                           .attr("y", minimapViewerDimensions.top+"px")
                           .attr("id", "minimapViewer")
                           .attr("stroke", '#1a324c')
                           .attr("stroke-width", 2);

                    }
                </script>
                
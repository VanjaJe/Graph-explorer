
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

                <style>
                .node {
                cursor: pointer;
                color: #5b5b5b;
                text-align: center;
                }

                .link {
                fill: none;
                stroke: #333333;
                stroke-width: 1.5px;
                }
                </style>

                <script type="text/javascript">
                
                    $(document).ready(function(){
                        init();
                    });
                    
                    var aspectRatioHeight = null;
                     var aspectRatioWidth = null;
                     var home = null;
                     var minimapDimensions = null;
                     var minimapViewer = null;
                     var minimapViewerDimensions = null;
                     var birdViewWidth = null;
                     var birdViewHeight = null;
                     var viewportDimensions = null;
                     var zoom = null;

                     viewportDimensions = {
                       height: 500,
                       width: 600
                     }

                     aspectRatioHeight = 0.25;
                     aspectRatioWidth = 0.25;

                     minimapDimensions = {
                       height: viewportDimensions.height * aspectRatioHeight,
                       width: viewportDimensions.width * aspectRatioWidth
                     };

                     minimapViewerDimensions = {
                       height: minimapDimensions.height,
                       width: minimapDimensions.width
                     }

                     home = d3.select("#mainView").node();

                    var current = null;
    
                    var nodesGraph = JSON.parse("{\u00221\u0022: {\u0022id\u0022: \u0022ID_1\u0022, \u0022attributes\u0022: [\u0022id: 1\u0022, \u0022@id: 2\u0022], \u0022weight\u0022: 1}, \u00222\u0022: {\u0022id\u0022: \u0022ID_2\u0022, \u0022attributes\u0022: [\u0022id: 2\u0022, \u0022@id: 6\u0022], \u0022weight\u0022: 1}, \u00223\u0022: {\u0022id\u0022: \u0022ID_3\u0022, \u0022attributes\u0022: [\u0022id: 3\u0022, \u0022@id: 10\u0022], \u0022weight\u0022: 1}, \u00220\u0022: {\u0022id\u0022: \u0022ID_0\u0022, \u0022attributes\u0022: [\u0022id: 0\u0022, \u0022@id: 1\u0022, \u0022name: Sergey Prokopyev\u0022, \u0022hobbies: [\u0027football\u0027, \u0027tennis\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 2}, {\u0027@id\u0027: 6}, {\u0027@id\u0027: 10}]\u0022], \u0022weight\u0022: 1}, \u00225\u0022: {\u0022id\u0022: \u0022ID_5\u0022, \u0022attributes\u0022: [\u0022id: 5\u0022, \u0022@id: 1\u0022], \u0022weight\u0022: 1}, \u00226\u0022: {\u0022id\u0022: \u0022ID_6\u0022, \u0022attributes\u0022: [\u0022id: 6\u0022, \u0022@id: 6\u0022], \u0022weight\u0022: 1}, \u00224\u0022: {\u0022id\u0022: \u0022ID_4\u0022, \u0022attributes\u0022: [\u0022id: 4\u0022, \u0022@id: 2\u0022, \u0022name: Dmitry Petelin\u0022, \u0022hobbies: [\u0027football\u0027, \u0027bowling\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 1}, {\u0027@id\u0027: 6}]\u0022], \u0022weight\u0022: 1}, \u00228\u0022: {\u0022id\u0022: \u0022ID_8\u0022, \u0022attributes\u0022: [\u0022id: 8\u0022, \u0022@id: 4\u0022], \u0022weight\u0022: 1}, \u00227\u0022: {\u0022id\u0022: \u0022ID_7\u0022, \u0022attributes\u0022: [\u0022id: 7\u0022, \u0022@id: 3\u0022, \u0022name: Frank Rubio\u0022, \u0022hobbies: [\u0027painting\u0027, \u0027singing\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 4}]\u0022], \u0022weight\u0022: 1}, \u002210\u0022: {\u0022id\u0022: \u0022ID_10\u0022, \u0022attributes\u0022: [\u0022id: 10\u0022, \u0022@id: 3\u0022], \u0022weight\u0022: 1}, \u00229\u0022: {\u0022id\u0022: \u0022ID_9\u0022, \u0022attributes\u0022: [\u0022id: 9\u0022, \u0022@id: 4\u0022, \u0022name: Nicole Mann\u0022, \u0022hobbies: [\u0027cooking\u0027, \u0027singing\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 3}]\u0022], \u0022weight\u0022: 1}, \u002212\u0022: {\u0022id\u0022: \u0022ID_12\u0022, \u0022attributes\u0022: [\u0022id: 12\u0022, \u0022@id: 6\u0022], \u0022weight\u0022: 1}, \u002211\u0022: {\u0022id\u0022: \u0022ID_11\u0022, \u0022attributes\u0022: [\u0022id: 11\u0022, \u0022@id: 5\u0022, \u0022name: Josh Cassada\u0022, \u0022hobbies: [\u0027fishing\u0027, \u0027hunting\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 6}]\u0022], \u0022weight\u0022: 1}, \u002214\u0022: {\u0022id\u0022: \u0022ID_14\u0022, \u0022attributes\u0022: [\u0022id: 14\u0022, \u0022@id: 2\u0022], \u0022weight\u0022: 1}, \u002215\u0022: {\u0022id\u0022: \u0022ID_15\u0022, \u0022attributes\u0022: [\u0022id: 15\u0022, \u0022@id: 3\u0022], \u0022weight\u0022: 1}, \u002216\u0022: {\u0022id\u0022: \u0022ID_16\u0022, \u0022attributes\u0022: [\u0022id: 16\u0022, \u0022@id: 4\u0022], \u0022weight\u0022: 1}, \u002213\u0022: {\u0022id\u0022: \u0022ID_13\u0022, \u0022attributes\u0022: [\u0022id: 13\u0022, \u0022@id: 6\u0022, \u0022name: Koichi Wakata\u0022, \u0022hobbies: [\u0027fishing\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 2}, {\u0027@id\u0027: 3}, {\u0027@id\u0027: 4}]\u0022], \u0022weight\u0022: 1}, \u002218\u0022: {\u0022id\u0022: \u0022ID_18\u0022, \u0022attributes\u0022: [\u0022id: 18\u0022, \u0022@id: 8\u0022], \u0022weight\u0022: 1}, \u002217\u0022: {\u0022id\u0022: \u0022ID_17\u0022, \u0022attributes\u0022: [\u0022id: 17\u0022, \u0022@id: 7\u0022, \u0022name: Anna Kikina\u0022, \u0022hobbies: [\u0027dancing\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 8}]\u0022], \u0022weight\u0022: 1}, \u002220\u0022: {\u0022id\u0022: \u0022ID_20\u0022, \u0022attributes\u0022: [\u0022id: 20\u0022, \u0022@id: 7\u0022], \u0022weight\u0022: 1}, \u002219\u0022: {\u0022id\u0022: \u0022ID_19\u0022, \u0022attributes\u0022: [\u0022id: 19\u0022, \u0022@id: 8\u0022, \u0022name: Fei Junlong\u0022, \u0022hobbies: [\u0027teaching\u0027, \u0027golfing\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 7}]\u0022], \u0022weight\u0022: 1}, \u002221\u0022: {\u0022id\u0022: \u0022ID_21\u0022, \u0022attributes\u0022: [\u0022id: 21\u0022, \u0022@id: 9\u0022, \u0022name: Deng Qingming\u0022, \u0022hobbies: [\u0027dancing\u0027]\u0022], \u0022weight\u0022: 1}, \u002223\u0022: {\u0022id\u0022: \u0022ID_23\u0022, \u0022attributes\u0022: [\u0022id: 23\u0022, \u0022@id: 2\u0022], \u0022weight\u0022: 1}, \u002222\u0022: {\u0022id\u0022: \u0022ID_22\u0022, \u0022attributes\u0022: [\u0022id: 22\u0022, \u0022@id: 10\u0022, \u0022name: Zhang Lu\u0022, \u0022hobbies: [\u0027dancing\u0027, \u0027teaching\u0027]\u0022, \u0022friends: [{\u0027@id\u0027: 2}]\u0022], \u0022weight\u0022: 1}}");                
                    var links= JSON.parse("[{\u0022source\u0022: 0, \u0022target\u0022: 1}, {\u0022source\u0022: 0, \u0022target\u0022: 2}, {\u0022source\u0022: 0, \u0022target\u0022: 3}, {\u0022source\u0022: 4, \u0022target\u0022: 5}, {\u0022source\u0022: 4, \u0022target\u0022: 6}, {\u0022source\u0022: 7, \u0022target\u0022: 8}, {\u0022source\u0022: 9, \u0022target\u0022: 10}, {\u0022source\u0022: 11, \u0022target\u0022: 12}, {\u0022source\u0022: 13, \u0022target\u0022: 14}, {\u0022source\u0022: 13, \u0022target\u0022: 15}, {\u0022source\u0022: 13, \u0022target\u0022: 16}, {\u0022source\u0022: 17, \u0022target\u0022: 18}, {\u0022source\u0022: 19, \u0022target\u0022: 20}, {\u0022source\u0022: 22, \u0022target\u0022: 23}, {\u0022source\u0022: 1, \u0022target\u0022: 4}, {\u0022source\u0022: 1, \u0022target\u0022: 14}, {\u0022source\u0022: 1, \u0022target\u0022: 23}, {\u0022source\u0022: 2, \u0022target\u0022: 6}, {\u0022source\u0022: 2, \u0022target\u0022: 12}, {\u0022source\u0022: 2, \u0022target\u0022: 13}, {\u0022source\u0022: 3, \u0022target\u0022: 22}, {\u0022source\u0022: 0, \u0022target\u0022: 5}, {\u0022source\u0022: 0, \u0022target\u0022: 4}, {\u0022source\u0022: 6, \u0022target\u0022: 12}, {\u0022source\u0022: 6, \u0022target\u0022: 13}, {\u0022source\u0022: 4, \u0022target\u0022: 14}, {\u0022source\u0022: 4, \u0022target\u0022: 23}, {\u0022source\u0022: 8, \u0022target\u0022: 9}, {\u0022source\u0022: 8, \u0022target\u0022: 16}, {\u0022source\u0022: 7, \u0022target\u0022: 10}, {\u0022source\u0022: 7, \u0022target\u0022: 9}, {\u0022source\u0022: 7, \u0022target\u0022: 15}, {\u0022source\u0022: 10, \u0022target\u0022: 15}, {\u0022source\u0022: 9, \u0022target\u0022: 16}, {\u0022source\u0022: 12, \u0022target\u0022: 13}, {\u0022source\u0022: 11, \u0022target\u0022: 13}, {\u0022source\u0022: 14, \u0022target\u0022: 23}, {\u0022source\u0022: 18, \u0022target\u0022: 19}, {\u0022source\u0022: 17, \u0022target\u0022: 20}, {\u0022source\u0022: 17, \u0022target\u0022: 21}, {\u0022source\u0022: 17, \u0022target\u0022: 22}, {\u0022source\u0022: 19, \u0022target\u0022: 22}, {\u0022source\u0022: 21, \u0022target\u0022: 22}]");
    
                    links.forEach(function(link) {
                        link.source = nodesGraph[link.source];
                        link.target = nodesGraph[link.target];
                    });
    
                    var svg = d3.select('#mainView').call(d3.behavior.zoom().on("zoom", function () {
                        svg.attr("transform", " translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
                        updateBirdViewRect(d3.event);
                        })).append('g');

                    function updateBirdViewRect(event) {
                        // Dohvatanje pravougaonika u birdView
                        let rect = d3.select("#divBird").select('rect');
                        console.log("ZUMIRA")

                        const action = d3.event.type === "zoom" && d3.event?.sourceEvent?.type === "mousemove" ? "PAN": "ZOOM";

                        if(action==="ZOOM") {

                            minimapViewerDimensions.height = rect.node().getBBox().height / event.scale;
                            minimapViewerDimensions.width = rect.node().getBBox().width / event.scale;
                        } else {

                            console.log(event.translate)

                            minimapViewerDimensions.top = -event.translate[1];
                            minimapViewerDimensions.left = -event.translate[0];

                            let graphWidth = d3.select("#mainView").select("g").node().getBBox().width;
                            let graphHeight = d3.select("#mainView").select("g").node().getBBox().height;

                            let mainWidth = document.getElementById("top").offsetWidth;
                            let mainHeight = document.getElementById("top").offsetHeight;

                            birdViewWidth = document.getElementById("divBird").offsetWidth
                            birdViewHeight = document.getElementById("divBird").offsetHeight

                            let scaleWidth = (birdViewWidth / mainWidth) / event.scale;
                            let scaleHeight = (birdViewHeight / mainHeight) / event.scale;

                            minimapViewerDimensions.top = minimapViewerDimensions.top * scaleHeight
                            minimapViewerDimensions.left = minimapViewerDimensions.left * scaleWidth
                            console.log("top: " + minimapViewerDimensions.top)
                            console.log("scale: " + scaleHeight)
                        }

                        // Pomeranje pravougaonika u skladu sa pan transformacijom
                        // d3.select("#birdView").select('rect').attr("x", document.getElementsByTagName("rect")[0].x - event.transform.x / event.translate)
                        //     .attr("y", document.getElementsByTagName("rect")[0].y - event.transform.y / event.translate);
                    }
    
                    var force = d3.layout.force()
                        .charge(-550)
                        .linkDistance(600)
                        .size([1500, 800])
                        .nodes(d3.values(nodesGraph)) 
                        .links(links) 
                        .on("tick", tick) 
                        .gravity(0.3)
                        .start(); 
    
                    var link = svg.selectAll('.link')
                        .data(links)
                        .enter().append('line')
                        .attr('class', 'link');
    
                    var node = svg.selectAll('.node')
                        .data(force.nodes())
                        .enter().append('g')
                        .attr('class', 'node')
                        .attr('id', function(d){return d.id;})
                        .on('click', clicked);
                    d3.selectAll('.node').each(function(d){nodeView(d, '#595959');});
    
                    function nodeView(d, color){
                        var width=30;
                        var textSize=12;
    
                        d3.select("g#"+d.id).append('circle').
                        attr('cx',0).attr('cy', 0).attr('r', width).attr('fill', color);
                        
                        d3.select("g#"+d.id).append('text').attr('x', 0).attr('y', 4)
                        .attr('text-anchor','middle')
                        .attr('font-size',textSize).attr('font-family','poppins')
                        .attr('fill','white').text(d.id);
                    }
    
                    while (force.alpha() > force.alphaMin()) { force.tick(); ticked(); }
    
                    function tick(e) {
    
                        node.attr("transform", function(d) {return "translate(" + d.x + "," + d.y + ")";})
                            .call(force.drag);
    
                        link.attr('x1', function(d) { return d.source.x; })
                            .attr('y1', function(d) { return d.source.y; })
                            .attr('x2', function(d) { return d.target.x; })
                            .attr('y2', function(d) { return d.target.y; });
    
                    }
    
                    function ticked() {
                        // console.log("Ticked");
                        node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
                    }
                    
                    function clicked(el){
                        console.log("USAO U CLICKED")
                        var message = "";
                        message += "ID:" + el.id + ", ";
                        if(current != null) {
                            d3.selectAll('.node').each(function(d){nodeView(d, '#595959');});
                            nodeView(nodesGraph[current.id.replace("ID_", "")], '#1a324c')
                        }
                        var node = nodesGraph[el.id.replace("ID_", "")];
                        current = node;
                        nodeView(current, '#1a324c')
                        for(var i=0;i<node.attributes.length;i++) {
                            message += node.attributes[i] + ", ";
                        }
                        console.log("PORUKA: " + message)
                        alert(message)
                        const wait = (n) => new Promise((resolve) => setTimeout(resolve, n));
                        const changeBackColor = async () => {
                          await wait(5000);
                          nodeView(node, '#595959')
                          node.attr('transform', function(d) {return 'translate(' + d.x + ',' + d.y + ')';}).call(force.drag);
                        };
                        // call the async function
                        changeBackColor();
                        node.attr('transform', function(d) {return 'translate(' + d.x + ',' + d.y + ')';}).call(force.drag);
                    }
                    
                    init();
                    
                    function init() {
                        let main = d3.select("#mainView").node();

                        let graphWidth = d3.select("#mainView").select("g").node().getBBox().width;
                        let graphHeight = d3.select("#mainView").select("g").node().getBBox().height;

                        let mainWidth = document.getElementById("top").offsetWidth;
                        let mainHeight = document.getElementById("top").offsetHeight;

                        let scaleWidth = mainWidth / graphWidth;
                        let scaleHeight = mainHeight / graphHeight;

                        let scale = 0;
                        if(scaleWidth < scaleHeight){
                            scale = scaleWidth;
                        }else{
                            scale = scaleHeight;
                        }

                        let birdWidth = $("#birdView")[0].clientWidth;
                        let birdHeight = $("#birdView")[0].clientHeight;

                        minimapViewerDimensions.height = birdHeight;
                        minimapViewerDimensions.width = birdWidth;
                        minimapViewerDimensions.top = 0;
                        minimapViewerDimensions.left = 0;

                        let x = d3.select("#mainView").select("g").node().getBBox().x;
                        let y = d3.select("#mainView").select("g").node().getBBox().y;
                        d3.select("#mainView").select('g').attr("transform", "translate ("+[-x*scale, -y*scale]+") scale("+ scale +")");

            
                        let observer = new MutationObserver(observer_callback);

                        observer.observe(main, {
                            subtree: true,
                            attributes: true,
                            childList: true,
                            characterData: true
                        });
                        
                    }
            
                    function observer_callback() {
                        let main = d3.select("#mainView").html();
                        d3.select("#birdView").html(main);

                        let graphWidth = d3.select("#mainView").select("g").node().getBBox().width;
                        let graphHeight = d3.select("#mainView").select("g").node().getBBox().height;

                        let mainWidth = document.getElementById("top").offsetWidth;
                        let mainHeight = document.getElementById("top").offsetHeight;


                        birdViewWidth = document.getElementById("divBird").offsetWidth
                        birdViewHeight = document.getElementById("divBird").offsetHeight


                        let birdWidth = $("#birdView")[0].clientWidth;
                        let birdHeight = $("#birdView")[0].clientHeight;


                        let scaleWidth = birdWidth / graphWidth;
                        let scaleHeight = birdHeight / graphHeight;

                        let scale = 0;
                        if(scaleWidth < scaleHeight){
                            scale = scaleWidth;
                        }else{
                            scale = scaleHeight;
                        }

                        let x = d3.select("#birdView").select("g").node().getBBox().x;
                        let y = d3.select("#birdView").select("g").node().getBBox().y;
                        d3.select("#birdView").select('g').attr("transform", "translate ("+[-x*scale, -y*scale]+") scale("+ scale +")");


                        let graphPosition = null;

                        let element = document.getElementsByTagName('g')[0];

                        if (element) {
                            // Dobijanje dimenzija i pozicije elementa u odnosu na prozor pregledaca
                            let rect = element.getBoundingClientRect();

                            // Relativna pozicija u odnosu na prozor pregledaca
                            graphPosition = {
                                top: rect.top,
                                left: rect.left,
                                width: rect.width,
                                height: rect.height
                            };

                            // minimapViewerDimensions.top = graphPosition.top * birdHeight/mainHeight;
                            // minimapViewerDimensions.left = graphPosition.left * birdWidth/mainWidth;
                        }


                        let rect = d3.select("#divBird").select('rect');

                         //Add a white viewbox onto the top of the minimap
                         minimapViewer = d3.select("#birdView")
                           .append("rect")
                           .attr("fill", "transparent")
                           .attr("height", minimapViewerDimensions.height)
                           .attr("width", minimapViewerDimensions.width)
                           .attr("x", minimapViewerDimensions.left)
                           .attr("y", minimapViewerDimensions.top)
                             .attr("position", "absolute")
                           .attr("id", "minimapViewer")
                           .attr("stroke", 'red')
                           .attr("stroke-width", 2);

                    }
                </script>
                